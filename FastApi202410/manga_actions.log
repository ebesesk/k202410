2024-11-08 11:42:03,251 - multipart.multipart - DEBUG - Calling on_field_start with no data
2024-11-08 11:42:03,251 - multipart.multipart - DEBUG - Calling on_field_name with data[0:8]
2024-11-08 11:42:03,252 - multipart.multipart - DEBUG - Calling on_field_data with data[9:12]
2024-11-08 11:42:03,252 - multipart.multipart - DEBUG - Calling on_field_end with no data
2024-11-08 11:42:03,253 - multipart.multipart - DEBUG - Calling on_field_start with no data
2024-11-08 11:42:03,253 - multipart.multipart - DEBUG - Calling on_field_name with data[13:21]
2024-11-08 11:42:03,254 - multipart.multipart - DEBUG - Calling on_field_data with data[22:30]
2024-11-08 11:42:03,254 - multipart.multipart - DEBUG - Calling on_field_end with no data
2024-11-08 11:42:03,254 - multipart.multipart - DEBUG - Calling on_end with no data
2024-11-08 11:42:03,299 - passlib.handlers.bcrypt - DEBUG - detected 'bcrypt' backend, version '4.0.1'
2024-11-08 11:42:03,300 - passlib.handlers.bcrypt - DEBUG - 'bcrypt' backend lacks $2$ support, enabling workaround
2024-11-08 11:42:13,444 - app.api.api_v1.endpoints.manga - INFO - Action request - action: move, manga_ids: [6367, 6357], target: __del
2024-11-08 11:42:13,449 - app.api.api_v1.endpoints.manga - INFO - Starting move operation for mangas: [6367, 6357]
2024-11-08 11:42:13,450 - app.api.api_v1.endpoints.manga - DEBUG - Move result: [{'manga': <app.models.manga.Manga object at 0x7f98af806210>, 'msg': '동일 장르로 이동 금지: /home/manga/__del/야란_6', 'success': False}, {'manga': <app.models.manga.Manga object at 0x7f98af8077d0>, 'msg': '동일 장르로 이동 금지: /home/manga/__del/18호_VS_거북선인', 'success': False}]
2024-11-08 11:42:13,450 - app.api.api_v1.endpoints.manga - ERROR - Move failures: ['동일 장르로 이동 금지: /home/manga/__del/야란_6', '동일 장르로 이동 금지: /home/manga/__del/18호_VS_거북선인']
2024-11-08 11:42:13,451 - app.api.api_v1.endpoints.manga - ERROR - Unexpected error during move: 400: {'message': 'Some manga moves failed', 'errors': ['동일 장르로 이동 금지: /home/manga/__del/야란_6', '동일 장르로 이동 금지: /home/manga/__del/18호_VS_거북선인']}
Traceback (most recent call last):
  File "/home/kds/k202410/FastApi202410/app/api/api_v1/endpoints/manga.py", line 153, in manga_action
    raise HTTPException(
fastapi.exceptions.HTTPException: 400: {'message': 'Some manga moves failed', 'errors': ['동일 장르로 이동 금지: /home/manga/__del/야란_6', '동일 장르로 이동 금지: /home/manga/__del/18호_VS_거북선인']}

2024-11-08 11:42:22,016 - app.api.api_v1.endpoints.manga - INFO - Action request - action: move, manga_ids: [6367, 6357], target: __중복
2024-11-08 11:42:22,020 - app.api.api_v1.endpoints.manga - INFO - Starting move operation for mangas: [6367, 6357]
2024-11-08 11:42:22,035 - app.api.api_v1.endpoints.manga - DEBUG - Move result: [{'manga': <app.models.manga.Manga object at 0x7f98af83ed20>, 'msg': '폴더 이동 성공: /home/manga/__del/야란_6 -> /home/manga/__중복/야란_6', 'success': True}, {'manga': <app.models.manga.Manga object at 0x7f98af83ed20>, 'msg': '폴더 이동 성공: /home/manga/__del/야란_6 -> /home/manga/__중복/야란_6', 'success': True}, {'manga': <app.models.manga.Manga object at 0x7f98af83ee70>, 'msg': '폴더 이동 성공: /home/manga/__del/18호_VS_거북선인 -> /home/manga/__중복/18호_VS_거북선인', 'success': True}, {'manga': <app.models.manga.Manga object at 0x7f98af83ee70>, 'msg': '폴더 이동 성공: /home/manga/__del/18호_VS_거북선인 -> /home/manga/__중복/18호_VS_거북선인', 'success': True}]
2024-11-08 11:42:22,035 - app.api.api_v1.endpoints.manga - INFO - Updating 4 manga records in DB
2024-11-08 11:42:22,381 - app.api.api_v1.endpoints.manga - ERROR - Unexpected error during move: name 'manga_db' is not defined
Traceback (most recent call last):
  File "/home/kds/k202410/FastApi202410/app/api/api_v1/endpoints/manga.py", line 168, in manga_action
    MangaCRUD.update_mangas_models(db, successful_mangas)
  File "/home/kds/k202410/FastApi202410/app/crud/manga.py", line 333, in update_mangas_models
    db.refresh(manga_db)
               ^^^^^^^^
NameError: name 'manga_db' is not defined

2024-11-08 11:42:22,386 - app.api.api_v1.endpoints.manga - ERROR - Unhandled exception: name 'manga_db' is not defined
Traceback (most recent call last):
  File "/home/kds/k202410/FastApi202410/app/api/api_v1/endpoints/manga.py", line 168, in manga_action
    MangaCRUD.update_mangas_models(db, successful_mangas)
  File "/home/kds/k202410/FastApi202410/app/crud/manga.py", line 333, in update_mangas_models
    db.refresh(manga_db)
               ^^^^^^^^
NameError: name 'manga_db' is not defined

2024-11-08 11:43:03,070 - app.api.api_v1.endpoints.manga - INFO - Action request - action: move, manga_ids: [6367, 6357, 6365, 6363], target: __del
2024-11-08 11:43:03,079 - app.api.api_v1.endpoints.manga - INFO - Starting move operation for mangas: [6367, 6357, 6365, 6363]
2024-11-08 11:43:03,105 - app.api.api_v1.endpoints.manga - DEBUG - Move result: [{'manga': <app.models.manga.Manga object at 0x7f2c7ce1c2c0>, 'msg': '폴더 이동 성공: /home/manga/__중복/야란_6 -> /home/manga/__del/야란_6', 'success': True}, {'manga': <app.models.manga.Manga object at 0x7f2c7ce1c2c0>, 'msg': '폴더 이동 성공: /home/manga/__중복/야란_6 -> /home/manga/__del/야란_6', 'success': True}, {'manga': <app.models.manga.Manga object at 0x7f2c7ce62ab0>, 'msg': '폴더 이동 성공: /home/manga/__중복/18호_VS_거북선인 -> /home/manga/__del/18호_VS_거북선인', 'success': True}, {'manga': <app.models.manga.Manga object at 0x7f2c7ce62ab0>, 'msg': '폴더 이동 성공: /home/manga/__중복/18호_VS_거북선인 -> /home/manga/__del/18호_VS_거북선인', 'success': True}, {'manga': <app.models.manga.Manga object at 0x7f2c7ce62bd0>, 'msg': '폴더 이동 성공: /home/manga/__중복/하메찌찌_1 -> /home/manga/__del/하메찌찌_1', 'success': True}, {'manga': <app.models.manga.Manga object at 0x7f2c7ce62bd0>, 'msg': '폴더 이동 성공: /home/manga/__중복/하메찌찌_1 -> /home/manga/__del/하메찌찌_1', 'success': True}, {'manga': <app.models.manga.Manga object at 0x7f2c7ce62000>, 'msg': '폴더 이동 성공: /home/manga/__중복/이토_준지_공포만화_벽_07권 -> /home/manga/__del/이토_준지_공포만화_벽_07권', 'success': True}, {'manga': <app.models.manga.Manga object at 0x7f2c7ce62000>, 'msg': '폴더 이동 성공: /home/manga/__중복/이토_준지_공포만화_벽_07권 -> /home/manga/__del/이토_준지_공포만화_벽_07권', 'success': True}]
2024-11-08 11:43:03,106 - app.api.api_v1.endpoints.manga - INFO - Updating 8 manga records in DB
2024-11-08 11:43:03,492 - app.api.api_v1.endpoints.manga - INFO - Update successful
2024-11-08 11:43:30,338 - app.api.api_v1.endpoints.manga - INFO - Action request - action: move, manga_ids: [6365, 6363, 6367, 6357], target: __중복
2024-11-08 11:43:30,344 - app.api.api_v1.endpoints.manga - INFO - Starting move operation for mangas: [6365, 6363, 6367, 6357]
2024-11-08 11:43:30,371 - app.api.api_v1.endpoints.manga - DEBUG - Move result: [{'manga': <app.models.manga.Manga object at 0x7f2c7cea49b0>, 'msg': '폴더 이동 성공: /home/manga/__del/하메찌찌_1 -> /home/manga/__중복/하메찌찌_1', 'success': True}, {'manga': <app.models.manga.Manga object at 0x7f2c7cea49b0>, 'msg': '폴더 이동 성공: /home/manga/__del/하메찌찌_1 -> /home/manga/__중복/하메찌찌_1', 'success': True}, {'manga': <app.models.manga.Manga object at 0x7f2c7cea4a40>, 'msg': '폴더 이동 성공: /home/manga/__del/이토_준지_공포만화_벽_07권 -> /home/manga/__중복/이토_준지_공포만화_벽_07권', 'success': True}, {'manga': <app.models.manga.Manga object at 0x7f2c7cea4a40>, 'msg': '폴더 이동 성공: /home/manga/__del/이토_준지_공포만화_벽_07권 -> /home/manga/__중복/이토_준지_공포만화_벽_07권', 'success': True}, {'manga': <app.models.manga.Manga object at 0x7f2c7cea5250>, 'msg': '폴더 이동 성공: /home/manga/__del/야란_6 -> /home/manga/__중복/야란_6', 'success': True}, {'manga': <app.models.manga.Manga object at 0x7f2c7cea5250>, 'msg': '폴더 이동 성공: /home/manga/__del/야란_6 -> /home/manga/__중복/야란_6', 'success': True}, {'manga': <app.models.manga.Manga object at 0x7f2c7cea52b0>, 'msg': '폴더 이동 성공: /home/manga/__del/18호_VS_거북선인 -> /home/manga/__중복/18호_VS_거북선인', 'success': True}, {'manga': <app.models.manga.Manga object at 0x7f2c7cea52b0>, 'msg': '폴더 이동 성공: /home/manga/__del/18호_VS_거북선인 -> /home/manga/__중복/18호_VS_거북선인', 'success': True}]
2024-11-08 11:43:30,371 - app.api.api_v1.endpoints.manga - INFO - Updating 8 manga records in DB
2024-11-08 11:43:30,753 - app.api.api_v1.endpoints.manga - INFO - Update successful
2024-11-08 11:54:00,232 - app.api.api_v1.endpoints.manga - INFO - Action request - action: move, manga_ids: [6363, 6357, 6365], target: __del
2024-11-08 11:54:00,236 - app.api.api_v1.endpoints.manga - INFO - Starting move operation for mangas: [6363, 6357, 6365]
2024-11-08 11:54:00,256 - app.api.api_v1.endpoints.manga - DEBUG - Move result: [{'manga': <app.models.manga.Manga object at 0x7f2c7cfa7ec0>, 'msg': '폴더 이동 성공: /home/manga/__중복/이토_준지_공포만화_벽_07권 -> /home/manga/__del/이토_준지_공포만화_벽_07권', 'success': True}, {'manga': <app.models.manga.Manga object at 0x7f2c7cfa7ec0>, 'msg': '폴더 이동 성공: /home/manga/__중복/이토_준지_공포만화_벽_07권 -> /home/manga/__del/이토_준지_공포만화_벽_07권', 'success': True}, {'manga': <app.models.manga.Manga object at 0x7f2c7cfa7c20>, 'msg': '폴더 이동 성공: /home/manga/__중복/18호_VS_거북선인 -> /home/manga/__del/18호_VS_거북선인', 'success': True}, {'manga': <app.models.manga.Manga object at 0x7f2c7cfa7c20>, 'msg': '폴더 이동 성공: /home/manga/__중복/18호_VS_거북선인 -> /home/manga/__del/18호_VS_거북선인', 'success': True}, {'manga': <app.models.manga.Manga object at 0x7f2c7cea4a10>, 'msg': '폴더 이동 성공: /home/manga/__중복/하메찌찌_1 -> /home/manga/__del/하메찌찌_1', 'success': True}, {'manga': <app.models.manga.Manga object at 0x7f2c7cea4a10>, 'msg': '폴더 이동 성공: /home/manga/__중복/하메찌찌_1 -> /home/manga/__del/하메찌찌_1', 'success': True}]
2024-11-08 11:54:00,257 - app.api.api_v1.endpoints.manga - INFO - Updating 6 manga records in DB
2024-11-08 11:54:00,663 - app.api.api_v1.endpoints.manga - INFO - Update successful
2024-11-08 11:54:32,239 - app.api.api_v1.endpoints.manga - INFO - Action request - action: merge, manga_ids: [6357, 6363], target: __del/18호_VS_거북선인
2024-11-08 11:54:32,242 - app.api.api_v1.endpoints.manga - INFO - Starting merge operation for mangas: [6357, 6363]
2024-11-08 11:54:32,514 - app.api.api_v1.endpoints.manga - DEBUG - Merge result: {'mangas': [<app.models.manga.Manga object at 0x7f2c7cea4b90>, <app.models.manga.Manga object at 0x7f2c7cea5b80>], 'msg': '폴더 병합 성공 (유지됨): /home/manga/__del/이토_준지_공포만화_벽_07권 -> /home/manga/__del/18호_VS_거북선인', 'success': True}
2024-11-08 11:54:32,545 - app.api.api_v1.endpoints.manga - ERROR - Unexpected error during merge: 500: Database update failed: (sqlite3.IntegrityError) UNIQUE constraint failed: manga.folder_name
[SQL: UPDATE manga SET folder_name=?, tags=?, page=?, images_name=?, update_date=? WHERE manga.id = ?]
[parameters: ('__del/18호_VS_거북선인', '{"size": 0, "titles": "__del/\\uc774\\ud1a0_\\uc900\\uc9c0_\\uacf5\\ud3ec\\ub9cc\\ud654_\\ubcbd_07\\uad8c___del/18\\ud638_VS_\\uac70\\ubd81\\uc120\\u ... (2826 characters truncated) ... 100-00011.jpg", "21100-00012.jpg", "21100-00013.jpg", "21100-00014.jpg", "21100-00015.jpg", "21100-00016.jpg", "21100-00017.jpg", "21100-00018.jpg"]}', 271, '["0100-0001.webp", "0100-0002.webp", "0100-0003.webp", "0100-0004.webp", "0100-0005.webp", "0100-0006.webp", "0100-0007.webp", "0100-0008.webp", "010 ... (4845 characters truncated) ... 1100-00011.jpg", "21100-00012.jpg", "21100-00013.jpg", "21100-00014.jpg", "21100-00015.jpg", "21100-00016.jpg", "21100-00017.jpg", "21100-00018.jpg"]', '2024-11-08 11:54:32.513985', 6363)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
sqlite3.IntegrityError: UNIQUE constraint failed: manga.folder_name

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/kds/k202410/FastApi202410/app/api/api_v1/endpoints/manga.py", line 205, in manga_action
    MangaCRUD.delete_manga_models(db, manga)
  File "/home/kds/k202410/FastApi202410/app/crud/manga.py", line 365, in delete_manga_models
    db.commit()
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2028, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 4352, in flush
    self._flush(objects)
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 4487, in _flush
    with util.safe_reraise():
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 4448, in _flush
    flush_context.execute()
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py", line 85, in save_obj
    _emit_update_statements(
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py", line 912, in _emit_update_statements
    c = connection.execute(
        ^^^^^^^^^^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
           ^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: manga.folder_name
[SQL: UPDATE manga SET folder_name=?, tags=?, page=?, images_name=?, update_date=? WHERE manga.id = ?]
[parameters: ('__del/18호_VS_거북선인', '{"size": 0, "titles": "__del/\\uc774\\ud1a0_\\uc900\\uc9c0_\\uacf5\\ud3ec\\ub9cc\\ud654_\\ubcbd_07\\uad8c___del/18\\ud638_VS_\\uac70\\ubd81\\uc120\\u ... (2826 characters truncated) ... 100-00011.jpg", "21100-00012.jpg", "21100-00013.jpg", "21100-00014.jpg", "21100-00015.jpg", "21100-00016.jpg", "21100-00017.jpg", "21100-00018.jpg"]}', 271, '["0100-0001.webp", "0100-0002.webp", "0100-0003.webp", "0100-0004.webp", "0100-0005.webp", "0100-0006.webp", "0100-0007.webp", "0100-0008.webp", "010 ... (4845 characters truncated) ... 1100-00011.jpg", "21100-00012.jpg", "21100-00013.jpg", "21100-00014.jpg", "21100-00015.jpg", "21100-00016.jpg", "21100-00017.jpg", "21100-00018.jpg"]', '2024-11-08 11:54:32.513985', 6363)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/kds/k202410/FastApi202410/app/api/api_v1/endpoints/manga.py", line 235, in manga_action
    raise HTTPException(status_code=500, detail=f"Database update failed: {str(e)}")
fastapi.exceptions.HTTPException: 500: Database update failed: (sqlite3.IntegrityError) UNIQUE constraint failed: manga.folder_name
[SQL: UPDATE manga SET folder_name=?, tags=?, page=?, images_name=?, update_date=? WHERE manga.id = ?]
[parameters: ('__del/18호_VS_거북선인', '{"size": 0, "titles": "__del/\\uc774\\ud1a0_\\uc900\\uc9c0_\\uacf5\\ud3ec\\ub9cc\\ud654_\\ubcbd_07\\uad8c___del/18\\ud638_VS_\\uac70\\ubd81\\uc120\\u ... (2826 characters truncated) ... 100-00011.jpg", "21100-00012.jpg", "21100-00013.jpg", "21100-00014.jpg", "21100-00015.jpg", "21100-00016.jpg", "21100-00017.jpg", "21100-00018.jpg"]}', 271, '["0100-0001.webp", "0100-0002.webp", "0100-0003.webp", "0100-0004.webp", "0100-0005.webp", "0100-0006.webp", "0100-0007.webp", "0100-0008.webp", "010 ... (4845 characters truncated) ... 1100-00011.jpg", "21100-00012.jpg", "21100-00013.jpg", "21100-00014.jpg", "21100-00015.jpg", "21100-00016.jpg", "21100-00017.jpg", "21100-00018.jpg"]', '2024-11-08 11:54:32.513985', 6363)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

2024-11-08 12:03:53,607 - app.api.api_v1.endpoints.manga - ERROR - Unexpected error during merge: 500: Database update failed: Instance '<Manga at 0x7f9deef93950>' is not persistent within this Session
Traceback (most recent call last):
  File "/home/kds/k202410/FastApi202410/app/api/api_v1/endpoints/manga.py", line 205, in manga_action
    MangaCRUD.delete_manga_models(db, manga)
  File "/home/kds/k202410/FastApi202410/app/crud/manga.py", line 366, in delete_manga_models
    db.refresh(manga)
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 3143, in refresh
    self._expire_state(state, attribute_names)
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 3269, in _expire_state
    self._validate_persistent(state)
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 4138, in _validate_persistent
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: Instance '<Manga at 0x7f9deef93950>' is not persistent within this Session

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/kds/k202410/FastApi202410/app/api/api_v1/endpoints/manga.py", line 235, in manga_action
    raise HTTPException(status_code=500, detail=f"Database update failed: {str(e)}")
fastapi.exceptions.HTTPException: 500: Database update failed: Instance '<Manga at 0x7f9deef93950>' is not persistent within this Session

2024-11-08 12:07:17,285 - app.api.api_v1.endpoints.manga - ERROR - Unexpected error during merge: 500: Database update failed: Instance '<Manga at 0x7f9deedb54c0>' is not persistent within this Session
Traceback (most recent call last):
  File "/home/kds/k202410/FastApi202410/app/api/api_v1/endpoints/manga.py", line 205, in manga_action
    MangaCRUD.delete_manga_models(db, manga)
  File "/home/kds/k202410/FastApi202410/app/crud/manga.py", line 366, in delete_manga_models
    db.refresh(manga)
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 3143, in refresh
    self._expire_state(state, attribute_names)
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 3269, in _expire_state
    self._validate_persistent(state)
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 4138, in _validate_persistent
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: Instance '<Manga at 0x7f9deedb54c0>' is not persistent within this Session

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/kds/k202410/FastApi202410/app/api/api_v1/endpoints/manga.py", line 235, in manga_action
    raise HTTPException(status_code=500, detail=f"Database update failed: {str(e)}")
fastapi.exceptions.HTTPException: 500: Database update failed: Instance '<Manga at 0x7f9deedb54c0>' is not persistent within this Session

2024-11-08 12:11:25,172 - app.api.api_v1.endpoints.manga - ERROR - Unexpected error during merge: 500: Database update failed: (sqlite3.IntegrityError) UNIQUE constraint failed: manga.folder_name
[SQL: UPDATE manga SET folder_name=?, tags=?, page=?, images_name=?, update_date=? WHERE manga.id = ?]
[parameters: ('__del/야에_신코_4', '{"size": 0, "titles": "__del/\\uc57c\\ub780_1___del/\\uc57c\\uc5d0_\\uc2e0\\ucf54_4_", "images": ["020-001.webp", "020-002.webp", "020-003.webp", "02 ... (72 characters truncated) ... bp", "020-009.webp", "020-010.webp", "020-011.webp", "020-012.webp", "020-013.webp", "020-014.webp", "020-015.webp", "020-016.webp", "020-017.webp"]}', 23, '["010-001.webp", "010-002.webp", "010-003.webp", "010-004.webp", "010-005.webp", "010-006.webp", "020-001.webp", "020-002.webp", "020-003.webp", "020 ... (70 characters truncated) ... ebp", "020-009.webp", "020-010.webp", "020-011.webp", "020-012.webp", "020-013.webp", "020-014.webp", "020-015.webp", "020-016.webp", "020-017.webp"]', '2024-11-08 12:11:25.138521', 6374)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
sqlite3.IntegrityError: UNIQUE constraint failed: manga.folder_name

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/kds/k202410/FastApi202410/app/api/api_v1/endpoints/manga.py", line 205, in manga_action
    MangaCRUD.delete_manga_models(db, manga)
  File "/home/kds/k202410/FastApi202410/app/crud/manga.py", line 365, in delete_manga_models
    db.commit()
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2028, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 4352, in flush
    self._flush(objects)
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 4487, in _flush
    with util.safe_reraise():
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 4448, in _flush
    flush_context.execute()
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py", line 85, in save_obj
    _emit_update_statements(
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py", line 912, in _emit_update_statements
    c = connection.execute(
        ^^^^^^^^^^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
           ^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: manga.folder_name
[SQL: UPDATE manga SET folder_name=?, tags=?, page=?, images_name=?, update_date=? WHERE manga.id = ?]
[parameters: ('__del/야에_신코_4', '{"size": 0, "titles": "__del/\\uc57c\\ub780_1___del/\\uc57c\\uc5d0_\\uc2e0\\ucf54_4_", "images": ["020-001.webp", "020-002.webp", "020-003.webp", "02 ... (72 characters truncated) ... bp", "020-009.webp", "020-010.webp", "020-011.webp", "020-012.webp", "020-013.webp", "020-014.webp", "020-015.webp", "020-016.webp", "020-017.webp"]}', 23, '["010-001.webp", "010-002.webp", "010-003.webp", "010-004.webp", "010-005.webp", "010-006.webp", "020-001.webp", "020-002.webp", "020-003.webp", "020 ... (70 characters truncated) ... ebp", "020-009.webp", "020-010.webp", "020-011.webp", "020-012.webp", "020-013.webp", "020-014.webp", "020-015.webp", "020-016.webp", "020-017.webp"]', '2024-11-08 12:11:25.138521', 6374)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/kds/k202410/FastApi202410/app/api/api_v1/endpoints/manga.py", line 235, in manga_action
    raise HTTPException(status_code=500, detail=f"Database update failed: {str(e)}")
fastapi.exceptions.HTTPException: 500: Database update failed: (sqlite3.IntegrityError) UNIQUE constraint failed: manga.folder_name
[SQL: UPDATE manga SET folder_name=?, tags=?, page=?, images_name=?, update_date=? WHERE manga.id = ?]
[parameters: ('__del/야에_신코_4', '{"size": 0, "titles": "__del/\\uc57c\\ub780_1___del/\\uc57c\\uc5d0_\\uc2e0\\ucf54_4_", "images": ["020-001.webp", "020-002.webp", "020-003.webp", "02 ... (72 characters truncated) ... bp", "020-009.webp", "020-010.webp", "020-011.webp", "020-012.webp", "020-013.webp", "020-014.webp", "020-015.webp", "020-016.webp", "020-017.webp"]}', 23, '["010-001.webp", "010-002.webp", "010-003.webp", "010-004.webp", "010-005.webp", "010-006.webp", "020-001.webp", "020-002.webp", "020-003.webp", "020 ... (70 characters truncated) ... ebp", "020-009.webp", "020-010.webp", "020-011.webp", "020-012.webp", "020-013.webp", "020-014.webp", "020-015.webp", "020-016.webp", "020-017.webp"]', '2024-11-08 12:11:25.138521', 6374)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

2024-11-08 12:14:13,272 - app.api.api_v1.endpoints.manga - ERROR - Unexpected error during merge: 500: Database update failed: (sqlite3.IntegrityError) UNIQUE constraint failed: manga.folder_name
[SQL: UPDATE manga SET folder_name=?, tags=?, page=?, images_name=?, update_date=? WHERE manga.id = ?]
[parameters: ('__del/EDGE_GARAM_Hidden_Backstory_Lara_Maple_MapleStory、TalesRunner_Korean_Digital', '{"size": 0, "titles": "__del/DUAL_LOVE_1___del/EDGE_GARAM_Hidden_Backstory_Lara_Maple_MapleStory\\u3001TalesRunner_Korean_Digital_", "images": ["020- ... (221 characters truncated) ... 020-016.jpg", "020-017.jpg", "020-018.jpg", "020-019.jpg", "020-020.jpg", "020-021.jpg", "020-022.jpg", "020-023.jpg", "020-024.jpg", "020-025.jpg"]}', 64, '["010-001.webp", "010-002.webp", "010-003.webp", "010-004.webp", "010-005.webp", "010-006.webp", "010-007.webp", "010-008.webp", "010-009.webp", "010 ... (701 characters truncated) ... "020-016.jpg", "020-017.jpg", "020-018.jpg", "020-019.jpg", "020-020.jpg", "020-021.jpg", "020-022.jpg", "020-023.jpg", "020-024.jpg", "020-025.jpg"]', '2024-11-08 12:14:13.257284', 6369)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
sqlite3.IntegrityError: UNIQUE constraint failed: manga.folder_name

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/kds/k202410/FastApi202410/app/api/api_v1/endpoints/manga.py", line 205, in manga_action
    MangaCRUD.delete_manga_models(db, manga)
  File "/home/kds/k202410/FastApi202410/app/crud/manga.py", line 365, in delete_manga_models
    db.commit()
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2028, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 4352, in flush
    self._flush(objects)
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 4487, in _flush
    with util.safe_reraise():
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 4448, in _flush
    flush_context.execute()
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py", line 85, in save_obj
    _emit_update_statements(
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py", line 912, in _emit_update_statements
    c = connection.execute(
        ^^^^^^^^^^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
           ^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: manga.folder_name
[SQL: UPDATE manga SET folder_name=?, tags=?, page=?, images_name=?, update_date=? WHERE manga.id = ?]
[parameters: ('__del/EDGE_GARAM_Hidden_Backstory_Lara_Maple_MapleStory、TalesRunner_Korean_Digital', '{"size": 0, "titles": "__del/DUAL_LOVE_1___del/EDGE_GARAM_Hidden_Backstory_Lara_Maple_MapleStory\\u3001TalesRunner_Korean_Digital_", "images": ["020- ... (221 characters truncated) ... 020-016.jpg", "020-017.jpg", "020-018.jpg", "020-019.jpg", "020-020.jpg", "020-021.jpg", "020-022.jpg", "020-023.jpg", "020-024.jpg", "020-025.jpg"]}', 64, '["010-001.webp", "010-002.webp", "010-003.webp", "010-004.webp", "010-005.webp", "010-006.webp", "010-007.webp", "010-008.webp", "010-009.webp", "010 ... (701 characters truncated) ... "020-016.jpg", "020-017.jpg", "020-018.jpg", "020-019.jpg", "020-020.jpg", "020-021.jpg", "020-022.jpg", "020-023.jpg", "020-024.jpg", "020-025.jpg"]', '2024-11-08 12:14:13.257284', 6369)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/kds/k202410/FastApi202410/app/api/api_v1/endpoints/manga.py", line 235, in manga_action
    raise HTTPException(status_code=500, detail=f"Database update failed: {str(e)}")
fastapi.exceptions.HTTPException: 500: Database update failed: (sqlite3.IntegrityError) UNIQUE constraint failed: manga.folder_name
[SQL: UPDATE manga SET folder_name=?, tags=?, page=?, images_name=?, update_date=? WHERE manga.id = ?]
[parameters: ('__del/EDGE_GARAM_Hidden_Backstory_Lara_Maple_MapleStory、TalesRunner_Korean_Digital', '{"size": 0, "titles": "__del/DUAL_LOVE_1___del/EDGE_GARAM_Hidden_Backstory_Lara_Maple_MapleStory\\u3001TalesRunner_Korean_Digital_", "images": ["020- ... (221 characters truncated) ... 020-016.jpg", "020-017.jpg", "020-018.jpg", "020-019.jpg", "020-020.jpg", "020-021.jpg", "020-022.jpg", "020-023.jpg", "020-024.jpg", "020-025.jpg"]}', 64, '["010-001.webp", "010-002.webp", "010-003.webp", "010-004.webp", "010-005.webp", "010-006.webp", "010-007.webp", "010-008.webp", "010-009.webp", "010 ... (701 characters truncated) ... "020-016.jpg", "020-017.jpg", "020-018.jpg", "020-019.jpg", "020-020.jpg", "020-021.jpg", "020-022.jpg", "020-023.jpg", "020-024.jpg", "020-025.jpg"]', '2024-11-08 12:14:13.257284', 6369)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

2024-11-08 12:20:41,160 - app.api.api_v1.endpoints.manga - ERROR - Unexpected error during merge: 500: Database update failed: (sqlite3.IntegrityError) UNIQUE constraint failed: manga.folder_name
[SQL: UPDATE manga SET folder_name=?, tags=?, page=?, images_name=?, update_date=? WHERE manga.id = ?]
[parameters: ('__del/미나모토_라이코', '{"size": 0, "titles": "__del/\\uc18d_\\uc774\\uc6c3\\uc774_\\uc790\\uc9c0\\ub97c_\\ube4c\\ub9ac\\ub7ec_\\uc624\\ub294_\\uc774\\uc57c\\uae30___del/\\u ... (121 characters truncated) ... bp", "020-005.webp", "020-006.webp", "020-007.webp", "020-008.webp", "020-009.webp", "020-010.webp", "020-011.webp", "020-012.webp", "020-013.webp"]}', 39, '["010-001.webp", "010-002.webp", "010-003.webp", "010-004.webp", "010-005.webp", "010-006.webp", "010-007.webp", "010-008.webp", "010-009.webp", "010 ... (326 characters truncated) ... ebp", "020-005.webp", "020-006.webp", "020-007.webp", "020-008.webp", "020-009.webp", "020-010.webp", "020-011.webp", "020-012.webp", "020-013.webp"]', '2024-11-08 12:20:41.126560', 6373)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
sqlite3.IntegrityError: UNIQUE constraint failed: manga.folder_name

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/kds/k202410/FastApi202410/app/api/api_v1/endpoints/manga.py", line 205, in manga_action
    MangaCRUD.delete_manga_models(db, manga)
  File "/home/kds/k202410/FastApi202410/app/crud/manga.py", line 365, in delete_manga_models
    db.commit()
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2028, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 4352, in flush
    self._flush(objects)
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 4487, in _flush
    with util.safe_reraise():
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 4448, in _flush
    flush_context.execute()
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py", line 85, in save_obj
    _emit_update_statements(
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py", line 912, in _emit_update_statements
    c = connection.execute(
        ^^^^^^^^^^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
           ^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: manga.folder_name
[SQL: UPDATE manga SET folder_name=?, tags=?, page=?, images_name=?, update_date=? WHERE manga.id = ?]
[parameters: ('__del/미나모토_라이코', '{"size": 0, "titles": "__del/\\uc18d_\\uc774\\uc6c3\\uc774_\\uc790\\uc9c0\\ub97c_\\ube4c\\ub9ac\\ub7ec_\\uc624\\ub294_\\uc774\\uc57c\\uae30___del/\\u ... (121 characters truncated) ... bp", "020-005.webp", "020-006.webp", "020-007.webp", "020-008.webp", "020-009.webp", "020-010.webp", "020-011.webp", "020-012.webp", "020-013.webp"]}', 39, '["010-001.webp", "010-002.webp", "010-003.webp", "010-004.webp", "010-005.webp", "010-006.webp", "010-007.webp", "010-008.webp", "010-009.webp", "010 ... (326 characters truncated) ... ebp", "020-005.webp", "020-006.webp", "020-007.webp", "020-008.webp", "020-009.webp", "020-010.webp", "020-011.webp", "020-012.webp", "020-013.webp"]', '2024-11-08 12:20:41.126560', 6373)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/kds/k202410/FastApi202410/app/api/api_v1/endpoints/manga.py", line 235, in manga_action
    raise HTTPException(status_code=500, detail=f"Database update failed: {str(e)}")
fastapi.exceptions.HTTPException: 500: Database update failed: (sqlite3.IntegrityError) UNIQUE constraint failed: manga.folder_name
[SQL: UPDATE manga SET folder_name=?, tags=?, page=?, images_name=?, update_date=? WHERE manga.id = ?]
[parameters: ('__del/미나모토_라이코', '{"size": 0, "titles": "__del/\\uc18d_\\uc774\\uc6c3\\uc774_\\uc790\\uc9c0\\ub97c_\\ube4c\\ub9ac\\ub7ec_\\uc624\\ub294_\\uc774\\uc57c\\uae30___del/\\u ... (121 characters truncated) ... bp", "020-005.webp", "020-006.webp", "020-007.webp", "020-008.webp", "020-009.webp", "020-010.webp", "020-011.webp", "020-012.webp", "020-013.webp"]}', 39, '["010-001.webp", "010-002.webp", "010-003.webp", "010-004.webp", "010-005.webp", "010-006.webp", "010-007.webp", "010-008.webp", "010-009.webp", "010 ... (326 characters truncated) ... ebp", "020-005.webp", "020-006.webp", "020-007.webp", "020-008.webp", "020-009.webp", "020-010.webp", "020-011.webp", "020-012.webp", "020-013.webp"]', '2024-11-08 12:20:41.126560', 6373)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

2024-11-08 12:23:52,372 - app.api.api_v1.endpoints.manga - ERROR - Unexpected error during merge: 500: Database update failed: Instance '<Manga at 0x7ff034876a50>' is not persistent within this Session
Traceback (most recent call last):
  File "/home/kds/k202410/FastApi202410/app/api/api_v1/endpoints/manga.py", line 205, in manga_action
    MangaCRUD.delete_manga_models(db, manga)
  File "/home/kds/k202410/FastApi202410/app/crud/manga.py", line 366, in delete_manga_models
    db.refresh(manga)
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 3143, in refresh
    self._expire_state(state, attribute_names)
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 3269, in _expire_state
    self._validate_persistent(state)
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 4138, in _validate_persistent
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: Instance '<Manga at 0x7ff034876a50>' is not persistent within this Session

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/kds/k202410/FastApi202410/app/api/api_v1/endpoints/manga.py", line 235, in manga_action
    raise HTTPException(status_code=500, detail=f"Database update failed: {str(e)}")
fastapi.exceptions.HTTPException: 500: Database update failed: Instance '<Manga at 0x7ff034876a50>' is not persistent within this Session

2024-11-08 12:24:09,218 - app.api.api_v1.endpoints.manga - ERROR - Unexpected error during merge: 500: Database update failed: Instance '<Manga at 0x7ff0348bfd10>' is not persistent within this Session
Traceback (most recent call last):
  File "/home/kds/k202410/FastApi202410/app/api/api_v1/endpoints/manga.py", line 205, in manga_action
    MangaCRUD.delete_manga_models(db, manga)
  File "/home/kds/k202410/FastApi202410/app/crud/manga.py", line 366, in delete_manga_models
    db.refresh(manga)
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 3143, in refresh
    self._expire_state(state, attribute_names)
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 3269, in _expire_state
    self._validate_persistent(state)
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 4138, in _validate_persistent
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: Instance '<Manga at 0x7ff0348bfd10>' is not persistent within this Session

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/kds/k202410/FastApi202410/app/api/api_v1/endpoints/manga.py", line 235, in manga_action
    raise HTTPException(status_code=500, detail=f"Database update failed: {str(e)}")
fastapi.exceptions.HTTPException: 500: Database update failed: Instance '<Manga at 0x7ff0348bfd10>' is not persistent within this Session

2024-11-08 12:48:48,436 - app.api.api_v1.endpoints.manga - ERROR - Unexpected error during merge: 500: Database update failed: Instance '<Manga at 0x7f68146e5160>' is not persistent within this Session
Traceback (most recent call last):
  File "/home/kds/k202410/FastApi202410/app/api/api_v1/endpoints/manga.py", line 206, in manga_action
    MangaCRUD.delete_manga_models(db, manga)
  File "/home/kds/k202410/FastApi202410/app/crud/manga.py", line 366, in delete_manga_models
    db.refresh(manga)
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 3143, in refresh
    self._expire_state(state, attribute_names)
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 3269, in _expire_state
    self._validate_persistent(state)
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 4138, in _validate_persistent
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: Instance '<Manga at 0x7f68146e5160>' is not persistent within this Session

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/kds/k202410/FastApi202410/app/api/api_v1/endpoints/manga.py", line 238, in manga_action
    raise HTTPException(status_code=500, detail=f"Database update failed: {str(e)}")
fastapi.exceptions.HTTPException: 500: Database update failed: Instance '<Manga at 0x7f68146e5160>' is not persistent within this Session

2024-11-08 12:52:06,960 - app.api.api_v1.endpoints.manga - ERROR - Unexpected error during merge: 500: Database operation failed: (sqlite3.IntegrityError) UNIQUE constraint failed: manga.folder_name
[SQL: UPDATE manga SET folder_name=?, tags=?, page=?, images_name=?, update_date=? WHERE manga.id = ?]
[parameters: ('__del/이영싫_나가_엄마', '{"size": 0, "titles": "__del/\\uc5b4\\ub978\\uc758_\\uc120_Lesson_2___del/\\uc774\\uc601\\uc2eb_\\ub098\\uac00_\\uc5c4\\ub9c8_", "images": ["020-001. ... (34 characters truncated) ... bp", "020-004.webp", "020-005.webp", "020-006.webp", "020-007.webp", "020-008.webp", "020-009.webp", "020-010.webp", "020-011.webp", "020-012.webp"]}', 41, '["010-001.webp", "010-002.webp", "010-003.webp", "010-004.webp", "010-005.webp", "010-006.webp", "010-007.webp", "010-008.webp", "010-009.webp", "010 ... (358 characters truncated) ... ebp", "020-004.webp", "020-005.webp", "020-006.webp", "020-007.webp", "020-008.webp", "020-009.webp", "020-010.webp", "020-011.webp", "020-012.webp"]', '2024-11-08 12:52:06.931780', 6385)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
sqlite3.IntegrityError: UNIQUE constraint failed: manga.folder_name

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/kds/k202410/FastApi202410/app/api/api_v1/endpoints/manga.py", line 209, in manga_action
    db.commit()  # 삭제 작업 커밋
    ^^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2028, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 4352, in flush
    self._flush(objects)
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 4487, in _flush
    with util.safe_reraise():
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 4448, in _flush
    flush_context.execute()
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py", line 85, in save_obj
    _emit_update_statements(
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py", line 912, in _emit_update_statements
    c = connection.execute(
        ^^^^^^^^^^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
           ^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: manga.folder_name
[SQL: UPDATE manga SET folder_name=?, tags=?, page=?, images_name=?, update_date=? WHERE manga.id = ?]
[parameters: ('__del/이영싫_나가_엄마', '{"size": 0, "titles": "__del/\\uc5b4\\ub978\\uc758_\\uc120_Lesson_2___del/\\uc774\\uc601\\uc2eb_\\ub098\\uac00_\\uc5c4\\ub9c8_", "images": ["020-001. ... (34 characters truncated) ... bp", "020-004.webp", "020-005.webp", "020-006.webp", "020-007.webp", "020-008.webp", "020-009.webp", "020-010.webp", "020-011.webp", "020-012.webp"]}', 41, '["010-001.webp", "010-002.webp", "010-003.webp", "010-004.webp", "010-005.webp", "010-006.webp", "010-007.webp", "010-008.webp", "010-009.webp", "010 ... (358 characters truncated) ... ebp", "020-004.webp", "020-005.webp", "020-006.webp", "020-007.webp", "020-008.webp", "020-009.webp", "020-010.webp", "020-011.webp", "020-012.webp"]', '2024-11-08 12:52:06.931780', 6385)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/kds/k202410/FastApi202410/app/api/api_v1/endpoints/manga.py", line 227, in manga_action
    raise HTTPException(
fastapi.exceptions.HTTPException: 500: Database operation failed: (sqlite3.IntegrityError) UNIQUE constraint failed: manga.folder_name
[SQL: UPDATE manga SET folder_name=?, tags=?, page=?, images_name=?, update_date=? WHERE manga.id = ?]
[parameters: ('__del/이영싫_나가_엄마', '{"size": 0, "titles": "__del/\\uc5b4\\ub978\\uc758_\\uc120_Lesson_2___del/\\uc774\\uc601\\uc2eb_\\ub098\\uac00_\\uc5c4\\ub9c8_", "images": ["020-001. ... (34 characters truncated) ... bp", "020-004.webp", "020-005.webp", "020-006.webp", "020-007.webp", "020-008.webp", "020-009.webp", "020-010.webp", "020-011.webp", "020-012.webp"]}', 41, '["010-001.webp", "010-002.webp", "010-003.webp", "010-004.webp", "010-005.webp", "010-006.webp", "010-007.webp", "010-008.webp", "010-009.webp", "010 ... (358 characters truncated) ... ebp", "020-004.webp", "020-005.webp", "020-006.webp", "020-007.webp", "020-008.webp", "020-009.webp", "020-010.webp", "020-011.webp", "020-012.webp"]', '2024-11-08 12:52:06.931780', 6385)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

2024-11-08 12:58:35,464 - app.api.api_v1.endpoints.manga - ERROR - Unexpected error during merge: 500: Database operation failed: (sqlite3.IntegrityError) UNIQUE constraint failed: manga.folder_name
[SQL: UPDATE manga SET folder_name=?, tags=?, page=?, images_name=?, update_date=? WHERE manga.id = ?]
[parameters: ('__del/카이사_조교일기', '{"size": 0, "titles": "__del/\\uc774\\uc601\\uc2eb_\\ub098\\uac00_\\uc5c4\\ub9c8___del/\\uce74\\uc774\\uc0ac_\\uc870\\uad50\\uc77c\\uae30_", "images" ... (178 characters truncated) ... bp", "0200-0005.webp", "0200-0006.webp", "0200-0007.webp", "0200-0008.webp", "0200-0009.webp", "0200-0010.webp", "0200-0011.webp", "0200-0012.webp"]}', 59, '["0100-0001.webp", "0100-0002.webp", "0100-0003.webp", "0100-0004.webp", "0100-0005.webp", "0100-0006.webp", "0100-0007.webp", "0100-0008.webp", "010 ... (764 characters truncated) ... ebp", "0200-0005.webp", "0200-0006.webp", "0200-0007.webp", "0200-0008.webp", "0200-0009.webp", "0200-0010.webp", "0200-0011.webp", "0200-0012.webp"]', '2024-11-08 12:58:35.445348', 6386)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
sqlite3.IntegrityError: UNIQUE constraint failed: manga.folder_name

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/kds/k202410/FastApi202410/app/crud/manga.py", line 258, in merge_manga
    db.commit()
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2028, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 4352, in flush
    self._flush(objects)
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 4487, in _flush
    with util.safe_reraise():
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 4448, in _flush
    flush_context.execute()
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py", line 85, in save_obj
    _emit_update_statements(
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py", line 912, in _emit_update_statements
    c = connection.execute(
        ^^^^^^^^^^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
           ^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: manga.folder_name
[SQL: UPDATE manga SET folder_name=?, tags=?, page=?, images_name=?, update_date=? WHERE manga.id = ?]
[parameters: ('__del/카이사_조교일기', '{"size": 0, "titles": "__del/\\uc774\\uc601\\uc2eb_\\ub098\\uac00_\\uc5c4\\ub9c8___del/\\uce74\\uc774\\uc0ac_\\uc870\\uad50\\uc77c\\uae30_", "images" ... (178 characters truncated) ... bp", "0200-0005.webp", "0200-0006.webp", "0200-0007.webp", "0200-0008.webp", "0200-0009.webp", "0200-0010.webp", "0200-0011.webp", "0200-0012.webp"]}', 59, '["0100-0001.webp", "0100-0002.webp", "0100-0003.webp", "0100-0004.webp", "0100-0005.webp", "0100-0006.webp", "0100-0007.webp", "0100-0008.webp", "010 ... (764 characters truncated) ... ebp", "0200-0005.webp", "0200-0006.webp", "0200-0007.webp", "0200-0008.webp", "0200-0009.webp", "0200-0010.webp", "0200-0011.webp", "0200-0012.webp"]', '2024-11-08 12:58:35.445348', 6386)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/kds/k202410/FastApi202410/app/api/api_v1/endpoints/manga.py", line 200, in manga_action
    MangaCRUD.merge_manga(db, mangas, result)
  File "/home/kds/k202410/FastApi202410/app/crud/manga.py", line 279, in merge_manga
    raise HTTPException(
fastapi.exceptions.HTTPException: 500: Database operation failed: (sqlite3.IntegrityError) UNIQUE constraint failed: manga.folder_name
[SQL: UPDATE manga SET folder_name=?, tags=?, page=?, images_name=?, update_date=? WHERE manga.id = ?]
[parameters: ('__del/카이사_조교일기', '{"size": 0, "titles": "__del/\\uc774\\uc601\\uc2eb_\\ub098\\uac00_\\uc5c4\\ub9c8___del/\\uce74\\uc774\\uc0ac_\\uc870\\uad50\\uc77c\\uae30_", "images" ... (178 characters truncated) ... bp", "0200-0005.webp", "0200-0006.webp", "0200-0007.webp", "0200-0008.webp", "0200-0009.webp", "0200-0010.webp", "0200-0011.webp", "0200-0012.webp"]}', 59, '["0100-0001.webp", "0100-0002.webp", "0100-0003.webp", "0100-0004.webp", "0100-0005.webp", "0100-0006.webp", "0100-0007.webp", "0100-0008.webp", "010 ... (764 characters truncated) ... ebp", "0200-0005.webp", "0200-0006.webp", "0200-0007.webp", "0200-0008.webp", "0200-0009.webp", "0200-0010.webp", "0200-0011.webp", "0200-0012.webp"]', '2024-11-08 12:58:35.445348', 6386)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

2024-11-08 13:01:53,413 - app.api.api_v1.endpoints.manga - ERROR - Unexpected error during merge: 500: Database operation failed: (sqlite3.IntegrityError) UNIQUE constraint failed: manga.folder_name
[SQL: UPDATE manga SET folder_name=?, tags=?, page=?, images_name=?, update_date=? WHERE manga.id = ?]
[parameters: ('__del/앞으로의_너에게', '{"size": 0, "titles": "__del/\\uc694\\uc774\\ubbf8\\uc57c_2___del/\\uc55e\\uc73c\\ub85c\\uc758_\\ub108\\uc5d0\\uac8c_", "images": ["0100-001.webp", " ... (649 characters truncated) ... 0-016.webp", "0200-017.webp", "0200-018.webp", "0200-019.webp", "0200-020.webp", "0200-021.webp", "0200-022.webp", "0200-023.webp", "0200-024.webp"]}', 72, '["010-001.webp", "010-002.webp", "010-003.webp", "010-004.webp", "010-005.webp", "010-006.webp", "010-007.webp", "010-008.webp", "010-009.webp", "010 ... (902 characters truncated) ... 00-016.webp", "0200-017.webp", "0200-018.webp", "0200-019.webp", "0200-020.webp", "0200-021.webp", "0200-022.webp", "0200-023.webp", "0200-024.webp"]', '2024-11-08 13:01:53.380961', 6381)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
sqlite3.IntegrityError: UNIQUE constraint failed: manga.folder_name

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/kds/k202410/FastApi202410/app/crud/manga.py", line 259, in merge_manga
    db.commit()
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2028, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 4352, in flush
    self._flush(objects)
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 4487, in _flush
    with util.safe_reraise():
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 4448, in _flush
    flush_context.execute()
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py", line 85, in save_obj
    _emit_update_statements(
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py", line 912, in _emit_update_statements
    c = connection.execute(
        ^^^^^^^^^^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
           ^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: manga.folder_name
[SQL: UPDATE manga SET folder_name=?, tags=?, page=?, images_name=?, update_date=? WHERE manga.id = ?]
[parameters: ('__del/앞으로의_너에게', '{"size": 0, "titles": "__del/\\uc694\\uc774\\ubbf8\\uc57c_2___del/\\uc55e\\uc73c\\ub85c\\uc758_\\ub108\\uc5d0\\uac8c_", "images": ["0100-001.webp", " ... (649 characters truncated) ... 0-016.webp", "0200-017.webp", "0200-018.webp", "0200-019.webp", "0200-020.webp", "0200-021.webp", "0200-022.webp", "0200-023.webp", "0200-024.webp"]}', 72, '["010-001.webp", "010-002.webp", "010-003.webp", "010-004.webp", "010-005.webp", "010-006.webp", "010-007.webp", "010-008.webp", "010-009.webp", "010 ... (902 characters truncated) ... 00-016.webp", "0200-017.webp", "0200-018.webp", "0200-019.webp", "0200-020.webp", "0200-021.webp", "0200-022.webp", "0200-023.webp", "0200-024.webp"]', '2024-11-08 13:01:53.380961', 6381)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/kds/k202410/FastApi202410/app/api/api_v1/endpoints/manga.py", line 200, in manga_action
    MangaCRUD.merge_manga(db, mangas, result)
  File "/home/kds/k202410/FastApi202410/app/crud/manga.py", line 291, in merge_manga
    raise HTTPException(
fastapi.exceptions.HTTPException: 500: Database operation failed: (sqlite3.IntegrityError) UNIQUE constraint failed: manga.folder_name
[SQL: UPDATE manga SET folder_name=?, tags=?, page=?, images_name=?, update_date=? WHERE manga.id = ?]
[parameters: ('__del/앞으로의_너에게', '{"size": 0, "titles": "__del/\\uc694\\uc774\\ubbf8\\uc57c_2___del/\\uc55e\\uc73c\\ub85c\\uc758_\\ub108\\uc5d0\\uac8c_", "images": ["0100-001.webp", " ... (649 characters truncated) ... 0-016.webp", "0200-017.webp", "0200-018.webp", "0200-019.webp", "0200-020.webp", "0200-021.webp", "0200-022.webp", "0200-023.webp", "0200-024.webp"]}', 72, '["010-001.webp", "010-002.webp", "010-003.webp", "010-004.webp", "010-005.webp", "010-006.webp", "010-007.webp", "010-008.webp", "010-009.webp", "010 ... (902 characters truncated) ... 00-016.webp", "0200-017.webp", "0200-018.webp", "0200-019.webp", "0200-020.webp", "0200-021.webp", "0200-022.webp", "0200-023.webp", "0200-024.webp"]', '2024-11-08 13:01:53.380961', 6381)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

2024-11-08 13:02:00,770 - app.api.api_v1.endpoints.manga - ERROR - OS error during merge: [Errno 2] No such file or directory: '/home/manga/__del/요이미야_2'
Traceback (most recent call last):
  File "/home/kds/k202410/FastApi202410/app/api/api_v1/endpoints/manga.py", line 186, in manga_action
    result = merge_manga_folder(mangas, target_folder_name)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kds/k202410/FastApi202410/app/utils/manga.py", line 435, in merge_manga_folder
    imgs = [i for i in os.listdir(src) if os.path.isfile(os.path.join(src, i)) and get_extension(i) in IMG_EXT + ZIP_EXT]
                       ^^^^^^^^^^^^^^^
FileNotFoundError: [Errno 2] No such file or directory: '/home/manga/__del/요이미야_2'

2024-11-08 13:02:20,532 - app.api.api_v1.endpoints.manga - ERROR - Unexpected error during merge: 500: Database operation failed: (sqlite3.IntegrityError) UNIQUE constraint failed: manga.folder_name
[SQL: UPDATE manga SET folder_name=?, tags=?, page=?, images_name=?, update_date=? WHERE manga.id = ?]
[parameters: ('__del/용서해주세요', '{"size": 0, "titles": "__del/\\ub9c8\\ub140_\\ubbf8\\ud3ec___del/\\uc6a9\\uc11c\\ud574\\uc8fc\\uc138\\uc694_", "images": ["020-001.webp", "020-002.we ... (3296 characters truncated) ... bp", "020-209.webp", "020-210.webp", "020-211.webp", "020-212.webp", "020-213.webp", "020-214.webp", "020-215.webp", "020-216.webp", "020-217.webp"]}', 223, '["010-001.webp", "010-002.webp", "010-003.webp", "010-004.webp", "010-005.webp", "010-006.webp", "020-001.webp", "020-002.webp", "020-003.webp", "020 ... (3270 characters truncated) ... ebp", "020-209.webp", "020-210.webp", "020-211.webp", "020-212.webp", "020-213.webp", "020-214.webp", "020-215.webp", "020-216.webp", "020-217.webp"]', '2024-11-08 13:02:20.518548', 6382)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
sqlite3.IntegrityError: UNIQUE constraint failed: manga.folder_name

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/kds/k202410/FastApi202410/app/crud/manga.py", line 259, in merge_manga
    db.commit()
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2028, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 4352, in flush
    self._flush(objects)
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 4487, in _flush
    with util.safe_reraise():
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 4448, in _flush
    flush_context.execute()
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py", line 85, in save_obj
    _emit_update_statements(
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py", line 912, in _emit_update_statements
    c = connection.execute(
        ^^^^^^^^^^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
           ^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: manga.folder_name
[SQL: UPDATE manga SET folder_name=?, tags=?, page=?, images_name=?, update_date=? WHERE manga.id = ?]
[parameters: ('__del/용서해주세요', '{"size": 0, "titles": "__del/\\ub9c8\\ub140_\\ubbf8\\ud3ec___del/\\uc6a9\\uc11c\\ud574\\uc8fc\\uc138\\uc694_", "images": ["020-001.webp", "020-002.we ... (3296 characters truncated) ... bp", "020-209.webp", "020-210.webp", "020-211.webp", "020-212.webp", "020-213.webp", "020-214.webp", "020-215.webp", "020-216.webp", "020-217.webp"]}', 223, '["010-001.webp", "010-002.webp", "010-003.webp", "010-004.webp", "010-005.webp", "010-006.webp", "020-001.webp", "020-002.webp", "020-003.webp", "020 ... (3270 characters truncated) ... ebp", "020-209.webp", "020-210.webp", "020-211.webp", "020-212.webp", "020-213.webp", "020-214.webp", "020-215.webp", "020-216.webp", "020-217.webp"]', '2024-11-08 13:02:20.518548', 6382)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/kds/k202410/FastApi202410/app/api/api_v1/endpoints/manga.py", line 200, in manga_action
    MangaCRUD.merge_manga(db, mangas, result)
  File "/home/kds/k202410/FastApi202410/app/crud/manga.py", line 291, in merge_manga
    raise HTTPException(
fastapi.exceptions.HTTPException: 500: Database operation failed: (sqlite3.IntegrityError) UNIQUE constraint failed: manga.folder_name
[SQL: UPDATE manga SET folder_name=?, tags=?, page=?, images_name=?, update_date=? WHERE manga.id = ?]
[parameters: ('__del/용서해주세요', '{"size": 0, "titles": "__del/\\ub9c8\\ub140_\\ubbf8\\ud3ec___del/\\uc6a9\\uc11c\\ud574\\uc8fc\\uc138\\uc694_", "images": ["020-001.webp", "020-002.we ... (3296 characters truncated) ... bp", "020-209.webp", "020-210.webp", "020-211.webp", "020-212.webp", "020-213.webp", "020-214.webp", "020-215.webp", "020-216.webp", "020-217.webp"]}', 223, '["010-001.webp", "010-002.webp", "010-003.webp", "010-004.webp", "010-005.webp", "010-006.webp", "020-001.webp", "020-002.webp", "020-003.webp", "020 ... (3270 characters truncated) ... ebp", "020-209.webp", "020-210.webp", "020-211.webp", "020-212.webp", "020-213.webp", "020-214.webp", "020-215.webp", "020-216.webp", "020-217.webp"]', '2024-11-08 13:02:20.518548', 6382)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

2024-11-08 13:12:44,470 - app.api.api_v1.endpoints.manga - ERROR - Unexpected error during merge: 500: Database update failed: Instance '<Manga at 0x7f2cedb90530>' is not persistent within this Session
Traceback (most recent call last):
  File "/home/kds/k202410/FastApi202410/app/api/api_v1/endpoints/manga.py", line 206, in manga_action
    MangaCRUD.delete_manga_models(db, manga)
  File "/home/kds/k202410/FastApi202410/app/crud/manga.py", line 369, in delete_manga_models
    db.refresh(manga)
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 3143, in refresh
    self._expire_state(state, attribute_names)
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 3269, in _expire_state
    self._validate_persistent(state)
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 4138, in _validate_persistent
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: Instance '<Manga at 0x7f2cedb90530>' is not persistent within this Session

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/kds/k202410/FastApi202410/app/api/api_v1/endpoints/manga.py", line 239, in manga_action
    raise HTTPException(status_code=500, detail=f"Database update failed: {str(e)}")
fastapi.exceptions.HTTPException: 500: Database update failed: Instance '<Manga at 0x7f2cedb90530>' is not persistent within this Session

2024-11-08 13:16:44,471 - app.api.api_v1.endpoints.manga - ERROR - Unexpected error during merge: 500: Database update failed: (sqlite3.IntegrityError) UNIQUE constraint failed: manga.folder_name
[SQL: UPDATE manga SET folder_name=?, tags=?, page=?, images_name=?, update_date=? WHERE manga.id = ?]
[parameters: ('__del/하메찌찌_1', '{"size": 0, "titles": "__del/29\\uc138_\\uc74c\\uc695_\\uc720\\ubd80\\ub140___del/\\ud558\\uba54\\ucc0c\\ucc0c_1_", "images": ["020-001.webp", "020-0 ... (213 characters truncated) ... bp", "020-016.webp", "020-017.webp", "020-018.webp", "020-019.webp", "020-020.webp", "020-021.webp", "020-022.webp", "020-023.webp", "020-024.webp"]}', 204, '["010-001.webp", "010-002.webp", "010-003.webp", "010-004.webp", "010-005.webp", "010-006.webp", "010-007.webp", "010-008.webp", "010-009.webp", "010 ... (2966 characters truncated) ... ebp", "020-016.webp", "020-017.webp", "020-018.webp", "020-019.webp", "020-020.webp", "020-021.webp", "020-022.webp", "020-023.webp", "020-024.webp"]', '2024-11-08 13:16:44.437559', 6406)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
sqlite3.IntegrityError: UNIQUE constraint failed: manga.folder_name

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/kds/k202410/FastApi202410/app/api/api_v1/endpoints/manga.py", line 206, in manga_action
    MangaCRUD.delete_manga_models(db, manga)
  File "/home/kds/k202410/FastApi202410/app/crud/manga.py", line 369, in delete_manga_models
    db.commit()
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2028, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 4352, in flush
    self._flush(objects)
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 4487, in _flush
    with util.safe_reraise():
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 4448, in _flush
    flush_context.execute()
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py", line 85, in save_obj
    _emit_update_statements(
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py", line 912, in _emit_update_statements
    c = connection.execute(
        ^^^^^^^^^^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
           ^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: manga.folder_name
[SQL: UPDATE manga SET folder_name=?, tags=?, page=?, images_name=?, update_date=? WHERE manga.id = ?]
[parameters: ('__del/하메찌찌_1', '{"size": 0, "titles": "__del/29\\uc138_\\uc74c\\uc695_\\uc720\\ubd80\\ub140___del/\\ud558\\uba54\\ucc0c\\ucc0c_1_", "images": ["020-001.webp", "020-0 ... (213 characters truncated) ... bp", "020-016.webp", "020-017.webp", "020-018.webp", "020-019.webp", "020-020.webp", "020-021.webp", "020-022.webp", "020-023.webp", "020-024.webp"]}', 204, '["010-001.webp", "010-002.webp", "010-003.webp", "010-004.webp", "010-005.webp", "010-006.webp", "010-007.webp", "010-008.webp", "010-009.webp", "010 ... (2966 characters truncated) ... ebp", "020-016.webp", "020-017.webp", "020-018.webp", "020-019.webp", "020-020.webp", "020-021.webp", "020-022.webp", "020-023.webp", "020-024.webp"]', '2024-11-08 13:16:44.437559', 6406)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/kds/k202410/FastApi202410/app/api/api_v1/endpoints/manga.py", line 239, in manga_action
    raise HTTPException(status_code=500, detail=f"Database update failed: {str(e)}")
fastapi.exceptions.HTTPException: 500: Database update failed: (sqlite3.IntegrityError) UNIQUE constraint failed: manga.folder_name
[SQL: UPDATE manga SET folder_name=?, tags=?, page=?, images_name=?, update_date=? WHERE manga.id = ?]
[parameters: ('__del/하메찌찌_1', '{"size": 0, "titles": "__del/29\\uc138_\\uc74c\\uc695_\\uc720\\ubd80\\ub140___del/\\ud558\\uba54\\ucc0c\\ucc0c_1_", "images": ["020-001.webp", "020-0 ... (213 characters truncated) ... bp", "020-016.webp", "020-017.webp", "020-018.webp", "020-019.webp", "020-020.webp", "020-021.webp", "020-022.webp", "020-023.webp", "020-024.webp"]}', 204, '["010-001.webp", "010-002.webp", "010-003.webp", "010-004.webp", "010-005.webp", "010-006.webp", "010-007.webp", "010-008.webp", "010-009.webp", "010 ... (2966 characters truncated) ... ebp", "020-016.webp", "020-017.webp", "020-018.webp", "020-019.webp", "020-020.webp", "020-021.webp", "020-022.webp", "020-023.webp", "020-024.webp"]', '2024-11-08 13:16:44.437559', 6406)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

2024-11-08 13:17:13,545 - app.api.api_v1.endpoints.manga - ERROR - Unexpected error during merge: 500: Database update failed: Instance '<Manga at 0x7f2a782acb30>' is not persistent within this Session
Traceback (most recent call last):
  File "/home/kds/k202410/FastApi202410/app/api/api_v1/endpoints/manga.py", line 206, in manga_action
    MangaCRUD.delete_manga_models(db, manga)
  File "/home/kds/k202410/FastApi202410/app/crud/manga.py", line 370, in delete_manga_models
    db.refresh(manga)
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 3143, in refresh
    self._expire_state(state, attribute_names)
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 3269, in _expire_state
    self._validate_persistent(state)
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 4138, in _validate_persistent
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: Instance '<Manga at 0x7f2a782acb30>' is not persistent within this Session

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/kds/k202410/FastApi202410/app/api/api_v1/endpoints/manga.py", line 239, in manga_action
    raise HTTPException(status_code=500, detail=f"Database update failed: {str(e)}")
fastapi.exceptions.HTTPException: 500: Database update failed: Instance '<Manga at 0x7f2a782acb30>' is not persistent within this Session

2024-11-08 13:25:51,299 - app.api.api_v1.endpoints.manga - ERROR - Unexpected error during merge: object NoneType can't be used in 'await' expression
Traceback (most recent call last):
  File "/home/kds/k202410/FastApi202410/app/api/api_v1/endpoints/manga.py", line 223, in manga_action
    async with db.begin():  # 트랜잭션 컨텍스트
               ^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 1939, in begin
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: A transaction is already begun on this Session.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/kds/k202410/FastApi202410/app/api/api_v1/endpoints/manga.py", line 271, in manga_action
    await db.rollback()
TypeError: object NoneType can't be used in 'await' expression

2024-11-08 13:25:51,301 - app.api.api_v1.endpoints.manga - ERROR - Unhandled exception: object NoneType can't be used in 'await' expression
Traceback (most recent call last):
  File "/home/kds/k202410/FastApi202410/app/api/api_v1/endpoints/manga.py", line 223, in manga_action
    async with db.begin():  # 트랜잭션 컨텍스트
               ^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 1939, in begin
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: A transaction is already begun on this Session.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/kds/k202410/FastApi202410/app/api/api_v1/endpoints/manga.py", line 271, in manga_action
    await db.rollback()
TypeError: object NoneType can't be used in 'await' expression

2024-11-08 13:25:51,324 - app.api.api_v1.endpoints.manga - ERROR - OS error during merge: [Errno 2] No such file or directory: '/home/manga/__del/음침한_조카는_이모와_하고싶다_무삭제판'
Traceback (most recent call last):
  File "/home/kds/k202410/FastApi202410/app/api/api_v1/endpoints/manga.py", line 186, in manga_action
    result = merge_manga_folder(mangas, target_folder_name)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kds/k202410/FastApi202410/app/utils/manga.py", line 435, in merge_manga_folder
    imgs = [i for i in os.listdir(src) if os.path.isfile(os.path.join(src, i)) and get_extension(i) in IMG_EXT + ZIP_EXT]
                       ^^^^^^^^^^^^^^^
FileNotFoundError: [Errno 2] No such file or directory: '/home/manga/__del/음침한_조카는_이모와_하고싶다_무삭제판'

2024-11-08 13:25:59,073 - app.api.api_v1.endpoints.manga - ERROR - Unexpected error during merge: object NoneType can't be used in 'await' expression
Traceback (most recent call last):
  File "/home/kds/k202410/FastApi202410/app/api/api_v1/endpoints/manga.py", line 223, in manga_action
    async with db.begin():  # 트랜잭션 컨텍스트
               ^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 1939, in begin
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: A transaction is already begun on this Session.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/kds/k202410/FastApi202410/app/api/api_v1/endpoints/manga.py", line 271, in manga_action
    await db.rollback()
TypeError: object NoneType can't be used in 'await' expression

2024-11-08 13:25:59,074 - app.api.api_v1.endpoints.manga - ERROR - Unhandled exception: object NoneType can't be used in 'await' expression
Traceback (most recent call last):
  File "/home/kds/k202410/FastApi202410/app/api/api_v1/endpoints/manga.py", line 223, in manga_action
    async with db.begin():  # 트랜잭션 컨텍스트
               ^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 1939, in begin
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: A transaction is already begun on this Session.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/kds/k202410/FastApi202410/app/api/api_v1/endpoints/manga.py", line 271, in manga_action
    await db.rollback()
TypeError: object NoneType can't be used in 'await' expression

2024-11-08 13:26:00,545 - app.api.api_v1.endpoints.manga - ERROR - OS error during merge: [Errno 2] No such file or directory: '/home/manga/__del/카이사_조교일기'
Traceback (most recent call last):
  File "/home/kds/k202410/FastApi202410/app/api/api_v1/endpoints/manga.py", line 186, in manga_action
    result = merge_manga_folder(mangas, target_folder_name)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kds/k202410/FastApi202410/app/utils/manga.py", line 435, in merge_manga_folder
    imgs = [i for i in os.listdir(src) if os.path.isfile(os.path.join(src, i)) and get_extension(i) in IMG_EXT + ZIP_EXT]
                       ^^^^^^^^^^^^^^^
FileNotFoundError: [Errno 2] No such file or directory: '/home/manga/__del/카이사_조교일기'

2024-11-08 13:26:12,641 - app.api.api_v1.endpoints.manga - ERROR - Unexpected error during merge: object NoneType can't be used in 'await' expression
Traceback (most recent call last):
  File "/home/kds/k202410/FastApi202410/app/api/api_v1/endpoints/manga.py", line 223, in manga_action
    async with db.begin():  # 트랜잭션 컨텍스트
               ^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 1939, in begin
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: A transaction is already begun on this Session.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/kds/k202410/FastApi202410/app/api/api_v1/endpoints/manga.py", line 271, in manga_action
    await db.rollback()
TypeError: object NoneType can't be used in 'await' expression

2024-11-08 13:26:12,643 - app.api.api_v1.endpoints.manga - ERROR - Unhandled exception: object NoneType can't be used in 'await' expression
Traceback (most recent call last):
  File "/home/kds/k202410/FastApi202410/app/api/api_v1/endpoints/manga.py", line 223, in manga_action
    async with db.begin():  # 트랜잭션 컨텍스트
               ^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 1939, in begin
    raise sa_exc.InvalidRequestError(
sqlalchemy.exc.InvalidRequestError: A transaction is already begun on this Session.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/kds/k202410/FastApi202410/app/api/api_v1/endpoints/manga.py", line 271, in manga_action
    await db.rollback()
TypeError: object NoneType can't be used in 'await' expression

2024-11-08 13:29:25,617 - app.api.api_v1.endpoints.manga - ERROR - Unexpected error during merge: 500: Database update failed: (sqlite3.IntegrityError) UNIQUE constraint failed: manga.folder_name
[SQL: UPDATE manga SET folder_name=?, tags=?, page=?, images_name=?, update_date=? WHERE manga.id = ?]
[parameters: ('__del/하메찌찌_1', '{"size": 0, "titles": "__del/\\uc0ac\\uc720\\ud0a4_\\uc544\\uac00\\uc528\\uc758_\\ud654\\ub824\\ud55c_\\uc77c\\uc0c12___del/\\ud558\\uba54\\ucc0c\\uc ... (3543 characters truncated) ... bp", "0200-0017.webp", "0200-0018.webp", "0200-0019.webp", "0200-0020.webp", "0200-0021.webp", "0200-0022.webp", "0200-0023.webp", "0200-0024.webp"]}', 275, '["0100-0001.webp", "0100-0002.webp", "0100-0003.webp", "0100-0004.webp", "0100-0005.webp", "0100-0006.webp", "0100-0007.webp", "0100-0008.webp", "010 ... (4652 characters truncated) ... ebp", "0200-0017.webp", "0200-0018.webp", "0200-0019.webp", "0200-0020.webp", "0200-0021.webp", "0200-0022.webp", "0200-0023.webp", "0200-0024.webp"]', '2024-11-08 13:29:25.581406', 6405)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
sqlite3.IntegrityError: UNIQUE constraint failed: manga.folder_name

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/kds/k202410/FastApi202410/app/api/api_v1/endpoints/manga.py", line 206, in manga_action
    MangaCRUD.delete_manga_models(db, manga)
  File "/home/kds/k202410/FastApi202410/app/crud/manga.py", line 369, in delete_manga_models
    db.commit()
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2028, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 4352, in flush
    self._flush(objects)
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 4487, in _flush
    with util.safe_reraise():
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 4448, in _flush
    flush_context.execute()
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py", line 85, in save_obj
    _emit_update_statements(
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py", line 912, in _emit_update_statements
    c = connection.execute(
        ^^^^^^^^^^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
           ^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: manga.folder_name
[SQL: UPDATE manga SET folder_name=?, tags=?, page=?, images_name=?, update_date=? WHERE manga.id = ?]
[parameters: ('__del/하메찌찌_1', '{"size": 0, "titles": "__del/\\uc0ac\\uc720\\ud0a4_\\uc544\\uac00\\uc528\\uc758_\\ud654\\ub824\\ud55c_\\uc77c\\uc0c12___del/\\ud558\\uba54\\ucc0c\\uc ... (3543 characters truncated) ... bp", "0200-0017.webp", "0200-0018.webp", "0200-0019.webp", "0200-0020.webp", "0200-0021.webp", "0200-0022.webp", "0200-0023.webp", "0200-0024.webp"]}', 275, '["0100-0001.webp", "0100-0002.webp", "0100-0003.webp", "0100-0004.webp", "0100-0005.webp", "0100-0006.webp", "0100-0007.webp", "0100-0008.webp", "010 ... (4652 characters truncated) ... ebp", "0200-0017.webp", "0200-0018.webp", "0200-0019.webp", "0200-0020.webp", "0200-0021.webp", "0200-0022.webp", "0200-0023.webp", "0200-0024.webp"]', '2024-11-08 13:29:25.581406', 6405)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/kds/k202410/FastApi202410/app/api/api_v1/endpoints/manga.py", line 218, in manga_action
    raise HTTPException(status_code=500, detail=f"Database update failed: {str(e)}")
fastapi.exceptions.HTTPException: 500: Database update failed: (sqlite3.IntegrityError) UNIQUE constraint failed: manga.folder_name
[SQL: UPDATE manga SET folder_name=?, tags=?, page=?, images_name=?, update_date=? WHERE manga.id = ?]
[parameters: ('__del/하메찌찌_1', '{"size": 0, "titles": "__del/\\uc0ac\\uc720\\ud0a4_\\uc544\\uac00\\uc528\\uc758_\\ud654\\ub824\\ud55c_\\uc77c\\uc0c12___del/\\ud558\\uba54\\ucc0c\\uc ... (3543 characters truncated) ... bp", "0200-0017.webp", "0200-0018.webp", "0200-0019.webp", "0200-0020.webp", "0200-0021.webp", "0200-0022.webp", "0200-0023.webp", "0200-0024.webp"]}', 275, '["0100-0001.webp", "0100-0002.webp", "0100-0003.webp", "0100-0004.webp", "0100-0005.webp", "0100-0006.webp", "0100-0007.webp", "0100-0008.webp", "010 ... (4652 characters truncated) ... ebp", "0200-0017.webp", "0200-0018.webp", "0200-0019.webp", "0200-0020.webp", "0200-0021.webp", "0200-0022.webp", "0200-0023.webp", "0200-0024.webp"]', '2024-11-08 13:29:25.581406', 6405)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

2024-11-08 13:38:22,082 - app.api.api_v1.endpoints.manga - ERROR - Unexpected error during merge: 500: Database update failed: (sqlite3.IntegrityError) UNIQUE constraint failed: manga.folder_name
[SQL: UPDATE manga SET folder_name=?, tags=?, page=?, images_name=?, update_date=? WHERE manga.id = ?]
[parameters: ('__del/하메찌찌_1', '{"size": 0, "titles": "__del/\\uc624\\ub298\\uc758_\\uc9c4\\uac80\\uc2b9\\ubd80_\\uc11c\\ube44\\uc2a4_\\uc5d0\\ub4c0\\ucf00\\uc774\\uc158_\\ud3b8___d ... (4288 characters truncated) ... 000-0173.webp", "01000-0174.webp", "01000-0175.webp", "01000-0176.webp", "01000-0177.webp", "01000-0178.webp", "01000-0179.webp", "01000-0180.webp"]}', 250, '["010-001.webp", "010-002.webp", "010-003.webp", "010-004.webp", "010-005.webp", "010-006.webp", "010-007.webp", "010-008.webp", "010-009.webp", "010 ... (4395 characters truncated) ... 1000-0173.webp", "01000-0174.webp", "01000-0175.webp", "01000-0176.webp", "01000-0177.webp", "01000-0178.webp", "01000-0179.webp", "01000-0180.webp"]', '2024-11-08 13:38:22.048200', 6399)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
sqlite3.IntegrityError: UNIQUE constraint failed: manga.folder_name

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/kds/k202410/FastApi202410/app/api/api_v1/endpoints/manga.py", line 208, in manga_action
    MangaCRUD.delete_manga_models(db, manga)
  File "/home/kds/k202410/FastApi202410/app/crud/manga.py", line 369, in delete_manga_models
    db.commit()
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2028, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 4352, in flush
    self._flush(objects)
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 4487, in _flush
    with util.safe_reraise():
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 4448, in _flush
    flush_context.execute()
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py", line 85, in save_obj
    _emit_update_statements(
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py", line 912, in _emit_update_statements
    c = connection.execute(
        ^^^^^^^^^^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
           ^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: manga.folder_name
[SQL: UPDATE manga SET folder_name=?, tags=?, page=?, images_name=?, update_date=? WHERE manga.id = ?]
[parameters: ('__del/하메찌찌_1', '{"size": 0, "titles": "__del/\\uc624\\ub298\\uc758_\\uc9c4\\uac80\\uc2b9\\ubd80_\\uc11c\\ube44\\uc2a4_\\uc5d0\\ub4c0\\ucf00\\uc774\\uc158_\\ud3b8___d ... (4288 characters truncated) ... 000-0173.webp", "01000-0174.webp", "01000-0175.webp", "01000-0176.webp", "01000-0177.webp", "01000-0178.webp", "01000-0179.webp", "01000-0180.webp"]}', 250, '["010-001.webp", "010-002.webp", "010-003.webp", "010-004.webp", "010-005.webp", "010-006.webp", "010-007.webp", "010-008.webp", "010-009.webp", "010 ... (4395 characters truncated) ... 1000-0173.webp", "01000-0174.webp", "01000-0175.webp", "01000-0176.webp", "01000-0177.webp", "01000-0178.webp", "01000-0179.webp", "01000-0180.webp"]', '2024-11-08 13:38:22.048200', 6399)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/kds/k202410/FastApi202410/app/api/api_v1/endpoints/manga.py", line 220, in manga_action
    raise HTTPException(status_code=500, detail=f"Database update failed: {str(e)}")
fastapi.exceptions.HTTPException: 500: Database update failed: (sqlite3.IntegrityError) UNIQUE constraint failed: manga.folder_name
[SQL: UPDATE manga SET folder_name=?, tags=?, page=?, images_name=?, update_date=? WHERE manga.id = ?]
[parameters: ('__del/하메찌찌_1', '{"size": 0, "titles": "__del/\\uc624\\ub298\\uc758_\\uc9c4\\uac80\\uc2b9\\ubd80_\\uc11c\\ube44\\uc2a4_\\uc5d0\\ub4c0\\ucf00\\uc774\\uc158_\\ud3b8___d ... (4288 characters truncated) ... 000-0173.webp", "01000-0174.webp", "01000-0175.webp", "01000-0176.webp", "01000-0177.webp", "01000-0178.webp", "01000-0179.webp", "01000-0180.webp"]}', 250, '["010-001.webp", "010-002.webp", "010-003.webp", "010-004.webp", "010-005.webp", "010-006.webp", "010-007.webp", "010-008.webp", "010-009.webp", "010 ... (4395 characters truncated) ... 1000-0173.webp", "01000-0174.webp", "01000-0175.webp", "01000-0176.webp", "01000-0177.webp", "01000-0178.webp", "01000-0179.webp", "01000-0180.webp"]', '2024-11-08 13:38:22.048200', 6399)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

2024-11-08 13:43:42,292 - app.api.api_v1.endpoints.manga - ERROR - OS error during merge: [Errno 2] No such file or directory: '/home/manga/__del/오늘의_진검승부_서비스_에듀케이션_편'
Traceback (most recent call last):
  File "/home/kds/k202410/FastApi202410/app/api/api_v1/endpoints/manga.py", line 186, in manga_action
    result = merge_manga_folder(mangas, target_folder_name)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kds/k202410/FastApi202410/app/utils/manga.py", line 437, in merge_manga_folder
    imgs = [i for i in os.listdir(src) if os.path.isfile(os.path.join(src, i)) and get_extension(i) in IMG_EXT + ZIP_EXT]
                       ^^^^^^^^^^^^^^^
FileNotFoundError: [Errno 2] No such file or directory: '/home/manga/__del/오늘의_진검승부_서비스_에듀케이션_편'

2024-11-08 13:50:03,513 - app.api.api_v1.endpoints.manga - ERROR - Unexpected error during merge: 500: Database update failed: (sqlite3.IntegrityError) UNIQUE constraint failed: manga.folder_name
[SQL: UPDATE manga SET folder_name=?, tags=?, page=?, images_name=?, update_date=? WHERE manga.id = ?]
[parameters: ('__del/바니코스☆허니', '{"size": 0, "titles": "__del/\\uc57c\\ud55c_\\ub204\\ub098\\ub294_\\uc88b\\uc544\\ud558\\ub098\\uc694_4___del/\\ubc14\\ub2c8\\ucf54\\uc2a4\\u2606\\ud ... (2033 characters truncated) ... 018.webp", "2010100-000019.webp", "2010100-000020.webp", "2010100-000021.webp", "2010100-000022.webp", "2010100-000023.webp", "2010100-000024.webp"]}', 218, '["011-0001.webp", "0100-0002.webp", "0100-0003.webp", "0100-0004.webp", "0100-0005.webp", "0100-0006.webp", "0100-0007.webp", "0100-0008.webp", "0100 ... (4205 characters truncated) ... 0018.webp", "2010100-000019.webp", "2010100-000020.webp", "2010100-000021.webp", "2010100-000022.webp", "2010100-000023.webp", "2010100-000024.webp"]', '2024-11-08 13:50:03.479601', 6393)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
sqlite3.IntegrityError: UNIQUE constraint failed: manga.folder_name

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/kds/k202410/FastApi202410/app/api/api_v1/endpoints/manga.py", line 208, in manga_action
    MangaCRUD.delete_manga_models(db, manga)
  File "/home/kds/k202410/FastApi202410/app/crud/manga.py", line 369, in delete_manga_models
    db.commit()
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2028, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 4352, in flush
    self._flush(objects)
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 4487, in _flush
    with util.safe_reraise():
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 4448, in _flush
    flush_context.execute()
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py", line 85, in save_obj
    _emit_update_statements(
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py", line 912, in _emit_update_statements
    c = connection.execute(
        ^^^^^^^^^^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
           ^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: manga.folder_name
[SQL: UPDATE manga SET folder_name=?, tags=?, page=?, images_name=?, update_date=? WHERE manga.id = ?]
[parameters: ('__del/바니코스☆허니', '{"size": 0, "titles": "__del/\\uc57c\\ud55c_\\ub204\\ub098\\ub294_\\uc88b\\uc544\\ud558\\ub098\\uc694_4___del/\\ubc14\\ub2c8\\ucf54\\uc2a4\\u2606\\ud ... (2033 characters truncated) ... 018.webp", "2010100-000019.webp", "2010100-000020.webp", "2010100-000021.webp", "2010100-000022.webp", "2010100-000023.webp", "2010100-000024.webp"]}', 218, '["011-0001.webp", "0100-0002.webp", "0100-0003.webp", "0100-0004.webp", "0100-0005.webp", "0100-0006.webp", "0100-0007.webp", "0100-0008.webp", "0100 ... (4205 characters truncated) ... 0018.webp", "2010100-000019.webp", "2010100-000020.webp", "2010100-000021.webp", "2010100-000022.webp", "2010100-000023.webp", "2010100-000024.webp"]', '2024-11-08 13:50:03.479601', 6393)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/kds/k202410/FastApi202410/app/api/api_v1/endpoints/manga.py", line 220, in manga_action
    raise HTTPException(status_code=500, detail=f"Database update failed: {str(e)}")
fastapi.exceptions.HTTPException: 500: Database update failed: (sqlite3.IntegrityError) UNIQUE constraint failed: manga.folder_name
[SQL: UPDATE manga SET folder_name=?, tags=?, page=?, images_name=?, update_date=? WHERE manga.id = ?]
[parameters: ('__del/바니코스☆허니', '{"size": 0, "titles": "__del/\\uc57c\\ud55c_\\ub204\\ub098\\ub294_\\uc88b\\uc544\\ud558\\ub098\\uc694_4___del/\\ubc14\\ub2c8\\ucf54\\uc2a4\\u2606\\ud ... (2033 characters truncated) ... 018.webp", "2010100-000019.webp", "2010100-000020.webp", "2010100-000021.webp", "2010100-000022.webp", "2010100-000023.webp", "2010100-000024.webp"]}', 218, '["011-0001.webp", "0100-0002.webp", "0100-0003.webp", "0100-0004.webp", "0100-0005.webp", "0100-0006.webp", "0100-0007.webp", "0100-0008.webp", "0100 ... (4205 characters truncated) ... 0018.webp", "2010100-000019.webp", "2010100-000020.webp", "2010100-000021.webp", "2010100-000022.webp", "2010100-000023.webp", "2010100-000024.webp"]', '2024-11-08 13:50:03.479601', 6393)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

2024-11-08 15:11:29,958 - app.api.api_v1.endpoints.manga - ERROR - OS error during merge: [Errno 2] No such file or directory: '/home/manga/__del/야한_누나는_좋아하나요_4'
Traceback (most recent call last):
  File "/home/kds/k202410/FastApi202410/app/api/api_v1/endpoints/manga.py", line 186, in manga_action
    result = merge_manga_folder(mangas, target_folder_name)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kds/k202410/FastApi202410/app/utils/manga.py", line 434, in merge_manga_folder
    imgs = [i for i in os.listdir(src) if os.path.isfile(os.path.join(src, i)) and get_extension(i) in IMG_EXT + ZIP_EXT]
                       ^^^^^^^^^^^^^^^
FileNotFoundError: [Errno 2] No such file or directory: '/home/manga/__del/야한_누나는_좋아하나요_4'

2024-11-08 15:12:05,053 - app.api.api_v1.endpoints.manga - ERROR - Unexpected error during merge: 500: Database update failed: (sqlite3.IntegrityError) UNIQUE constraint failed: manga.folder_name
[SQL: UPDATE manga SET folder_name=?, tags=?, page=?, images_name=?, update_date=? WHERE manga.id = ?]
[parameters: ('__del/여친타락', '{"size": 0, "titles": "__del/\\uc55e\\uc73c\\ub85c\\uc758_\\ub108\\uc5d0\\uac8c___del/\\uc5ec\\uce5c\\ud0c0\\ub77d_", "images": ["010000-00001.webp", ... (2218 characters truncated) ... -00079.webp", "03000-00080.webp", "03000-00081.webp", "0400-00001.webp", "0400-00002.webp", "0400-00003.webp", "0400-00004.webp", "0400-00005.webp"]}', 389, '["01000-0001.webp", "01000-0002.webp", "01000-0003.webp", "01000-0004.webp", "01000-0005.webp", "01000-0006.webp", "01000-0007.webp", "01000-0008.web ... (7238 characters truncated) ... 0-00079.webp", "03000-00080.webp", "03000-00081.webp", "0400-00001.webp", "0400-00002.webp", "0400-00003.webp", "0400-00004.webp", "0400-00005.webp"]', '2024-11-08 15:12:05.020542', 6380)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)
Traceback (most recent call last):
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
sqlite3.IntegrityError: UNIQUE constraint failed: manga.folder_name

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/kds/k202410/FastApi202410/app/api/api_v1/endpoints/manga.py", line 208, in manga_action
    MangaCRUD.delete_manga_models(db, manga)
  File "/home/kds/k202410/FastApi202410/app/crud/manga.py", line 369, in delete_manga_models
    db.commit()
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 2028, in commit
    trans.commit(_to_root=True)
  File "<string>", line 2, in commit
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 1313, in commit
    self._prepare_impl()
  File "<string>", line 2, in _prepare_impl
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/state_changes.py", line 139, in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 1288, in _prepare_impl
    self.session.flush()
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 4352, in flush
    self._flush(objects)
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 4487, in _flush
    with util.safe_reraise():
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/util/langhelpers.py", line 146, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/session.py", line 4448, in _flush
    flush_context.execute()
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py", line 466, in execute
    rec.execute(self)
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/unitofwork.py", line 642, in execute
    util.preloaded.orm_persistence.save_obj(
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py", line 85, in save_obj
    _emit_update_statements(
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/orm/persistence.py", line 912, in _emit_update_statements
    c = connection.execute(
        ^^^^^^^^^^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
    return meth(
           ^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/kds/k202410/venv202410/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.IntegrityError: (sqlite3.IntegrityError) UNIQUE constraint failed: manga.folder_name
[SQL: UPDATE manga SET folder_name=?, tags=?, page=?, images_name=?, update_date=? WHERE manga.id = ?]
[parameters: ('__del/여친타락', '{"size": 0, "titles": "__del/\\uc55e\\uc73c\\ub85c\\uc758_\\ub108\\uc5d0\\uac8c___del/\\uc5ec\\uce5c\\ud0c0\\ub77d_", "images": ["010000-00001.webp", ... (2218 characters truncated) ... -00079.webp", "03000-00080.webp", "03000-00081.webp", "0400-00001.webp", "0400-00002.webp", "0400-00003.webp", "0400-00004.webp", "0400-00005.webp"]}', 389, '["01000-0001.webp", "01000-0002.webp", "01000-0003.webp", "01000-0004.webp", "01000-0005.webp", "01000-0006.webp", "01000-0007.webp", "01000-0008.web ... (7238 characters truncated) ... 0-00079.webp", "03000-00080.webp", "03000-00081.webp", "0400-00001.webp", "0400-00002.webp", "0400-00003.webp", "0400-00004.webp", "0400-00005.webp"]', '2024-11-08 15:12:05.020542', 6380)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/kds/k202410/FastApi202410/app/api/api_v1/endpoints/manga.py", line 220, in manga_action
    raise HTTPException(status_code=500, detail=f"Database update failed: {str(e)}")
fastapi.exceptions.HTTPException: 500: Database update failed: (sqlite3.IntegrityError) UNIQUE constraint failed: manga.folder_name
[SQL: UPDATE manga SET folder_name=?, tags=?, page=?, images_name=?, update_date=? WHERE manga.id = ?]
[parameters: ('__del/여친타락', '{"size": 0, "titles": "__del/\\uc55e\\uc73c\\ub85c\\uc758_\\ub108\\uc5d0\\uac8c___del/\\uc5ec\\uce5c\\ud0c0\\ub77d_", "images": ["010000-00001.webp", ... (2218 characters truncated) ... -00079.webp", "03000-00080.webp", "03000-00081.webp", "0400-00001.webp", "0400-00002.webp", "0400-00003.webp", "0400-00004.webp", "0400-00005.webp"]}', 389, '["01000-0001.webp", "01000-0002.webp", "01000-0003.webp", "01000-0004.webp", "01000-0005.webp", "01000-0006.webp", "01000-0007.webp", "01000-0008.web ... (7238 characters truncated) ... 0-00079.webp", "03000-00080.webp", "03000-00081.webp", "0400-00001.webp", "0400-00002.webp", "0400-00003.webp", "0400-00004.webp", "0400-00005.webp"]', '2024-11-08 15:12:05.020542', 6380)]
(Background on this error at: https://sqlalche.me/e/20/gkpj)

